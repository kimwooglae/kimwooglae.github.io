<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <title>SignaturePad eraser feature</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta name="robots" content="noindex, nofollow" />
    <meta name="googlebot" content="noindex, nofollow" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script type="text/javascript" src="signature_pad.umd.js"></script>

    <style id="compiled-css" type="text/css">
      .wrapper {
        position: relative;
        width: 400px;
        height: 200px;
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
        user-select: none;
        border: 1px solid #000;
      }

      .signature-pad {
        position: absolute;
        left: 0;
        top: 0;
        width: 400px;
        height: 200px;
        background-color: white;
      }

      /* EOS */
    </style>

    <script type="text/javascript">
      const customConsole = (w) => {
        const pushToConsole = (payload, type) => {
          document.getElementById("output").innerHTML =
            JSON.stringify(payload) +
            "<br>" +
            document.getElementById("output").innerHTML;
        };

        w.onerror = (message, url, line, column) => {
          // the line needs to correspond with the editor panel
          // unfortunately this number needs to be altered every time this view is changed
          line = line - 70;
          if (line < 0) {
            pushToConsole(message, "error");
          } else {
            pushToConsole(`[${line}:${column}] ${message}`, "error");
          }
        };

        let console = (function (systemConsole) {
          return {
            log: function () {
              let args = Array.from(arguments);
              pushToConsole(args, "log");
              systemConsole.log.apply(this, args);
            },
            info: function () {
              let args = Array.from(arguments);
              pushToConsole(args, "info");
              systemConsole.info.apply(this, args);
            },
            warn: function () {
              let args = Array.from(arguments);
              pushToConsole(args, "warn");
              systemConsole.warn.apply(this, args);
            },
            error: function () {
              let args = Array.from(arguments);
              pushToConsole(args, "error");
              systemConsole.error.apply(this, args);
            },
            system: function (arg) {
              pushToConsole(arg, "system");
            },
            clear: function () {
              systemConsole.clear.apply(this, {});
            },
            time: function () {
              let args = Array.from(arguments);
              systemConsole.time.apply(this, args);
            },
            assert: function (assertion, label) {
              if (!assertion) {
                pushToConsole(label, "log");
              }

              let args = Array.from(arguments);
              systemConsole.assert.apply(this, args);
            },
          };
        })(window.console);

        window.console = { ...window.console, ...console };

        console.system("Running fiddle");
      };

      window.onload = function () {
        customConsole(window);
        var canvasPressure = document.getElementById("signature-pad-pressure");

        var signaturePadPressure = new SignaturePad(canvasPressure, {
          backgroundColor: "rgb(255, 255, 255)", // necessary for saving image as JPEG; can be removed is only saving as PNG or SVG
          usePressure: true,
        });

        var canvasVelocity = document.getElementById("signature-pad-velocity");

        var signaturePadVelocity = new SignaturePad(canvasVelocity, {
          backgroundColor: "rgb(255, 255, 255)", // necessary for saving image as JPEG; can be removed is only saving as PNG or SVG
          usePressure: false,
        });

        document
          .getElementById("save-png")
          .addEventListener("click", function () {
            // if (signaturePadPressure.isEmpty()) {
            //   return alert("Please provide a signature first.");
            // }
            var data = signaturePadPressure.toDataURL("image/png");
            document.getElementById("signature-img-pressure").src = data;
            var data = signaturePadVelocity.toDataURL("image/png");
            document.getElementById("signature-img-velocity").src = data;
            console.log(data);
          });

        document
          .getElementById("save-jpeg")
          .addEventListener("click", function () {
            // if (signaturePad.isEmpty()) {
            //   return alert("Please provide a signature first.");
            // }

            var data = signaturePadPressure.toDataURL("image/jpeg");
            document.getElementById("signature-img-pressure").src = data;
            var data = signaturePadVelocity.toDataURL("image/jpeg");
            document.getElementById("signature-img-velocity").src = data;
            console.log(data);
          });

        document
          .getElementById("save-svg")
          .addEventListener("click", function () {
            // if (signaturePad.isEmpty()) {
            //   return alert("Please provide a signature first.");
            // }

            var data = signaturePadPressure.toDataURL("image/svg+xml");
            document.getElementById("signature-img-pressure").src = data;
            var data = signaturePadVelocity.toDataURL("image/svg+xml");
            document.getElementById("signature-img-velocity").src = data;
            console.log(data);
          });

        document.getElementById("clear").addEventListener("click", function () {
          signaturePad.clear();
        });

        document.getElementById("draw").addEventListener("click", function () {
          var ctx = canvas.getContext("2d");
          console.log(ctx.globalCompositeOperation);
          ctx.globalCompositeOperation = "source-over"; // default value
        });
      };
    </script>
  </head>
  <body>
    <div class="wrapper">
      <canvas
        id="signature-pad-pressure"
        class="signature-pad"
        width="400"
        height="200"
      ></canvas>
    </div>
    <div class="wrapper">
      <canvas
        id="signature-pad-velocity"
        class="signature-pad"
        width="400"
        height="200"
      ></canvas>
    </div>

    <button id="save-png">Save as PNG</button>
    <button id="save-jpeg">Save as JPEG</button>
    <button id="save-svg">Save as SVG</button>
    <button id="draw">Draw</button>
    <button id="clear">Clear</button>
    <div>
      <img id="signature-img-pressure" style="width: 400px; height: 200px" />
      <img id="signature-img-velocity" style="width: 400px; height: 200px" />
    </div>
    <div id="output"></div>
  </body>
</html>
